<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitbit Research Data Collection - Authorization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #00B2A9;
            margin-bottom: 30px;
        }
        .info-section {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-left: 4px solid #00B2A9;
        }
        .auth-button {
            display: inline-block;
            background-color: #00B2A9;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
            transition: background-color 0.3s;
        }
        .auth-button:hover {
            background-color: #008a82;
        }
        .footer-links {
            margin-top: 30px;
            text-align: center;
        }
        .footer-links a {
            color: #00B2A9;
            margin: 0 15px;
            text-decoration: none;
        }
        .footer-links a:hover {
            text-decoration: underline;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Fitbit Research Data Collection</h1>
            <h2>Participant Authorization</h2>
        </div>

        <div class="info-section">
            <h3>About This Research</h3>
            <p>We are conducting research using Fitbit data to better understand health patterns and behaviors. Your participation is voluntary and your data will be used solely for research purposes.</p>
        </div>

        <div class="info-section">
            <h3>What Data We Will Access</h3>
            <ul>
                <li><strong>Activity Data:</strong> Steps, distance, calories burned, active minutes</li>
                <li><strong>Sleep Data:</strong> Sleep duration, sleep stages, sleep efficiency</li>
                <li><strong>Heart Rate:</strong> Resting heart rate, heart rate zones</li>
                <li><strong>Profile Information:</strong> Age, gender, height, weight (if provided)</li>
            </ul>
        </div>

        <div class="warning">
            <strong>Important:</strong> By clicking "Authorize Fitbit Access" below, you give permission for researchers to access your Fitbit data for research purposes. You can revoke this access at any time through your Fitbit account settings.
        </div>

        <div style="text-align: center;">
            <a href="#" id="authButton" class="auth-button">Authorize Fitbit Access</a>
        </div>

        <div class="info-section">
            <h3>Data Privacy & Security</h3>
            <p>Your data will be:</p>
            <ul>
                <li>Stored securely and encrypted</li>
                <li>Used only for research purposes</li>
                <li>Never shared with third parties without your consent</li>
                <li>De-identified when possible</li>
            </ul>
        </div>

        <div class="footer-links">
            <a href="privacy.html">Privacy Policy</a>
            <a href="terms.html">Terms of Service</a>
        </div>
    </div>

    <script>
        // Configuration moved to secure backend
        // Frontend only handles UI and redirects

        document.getElementById('authButton').addEventListener('click', async function(e) {
            e.preventDefault();
            
            try {
                // Get authorization URL from secure backend
                const backendUrl = 'https://your-backend-domain.com/api/auth/url'; // Update with your backend URL
                
                const response = await fetch(backendUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to get authorization URL');
                }

                const data = await response.json();
                
                // Store state for verification
                localStorage.setItem('fitbit_state', data.state);

                // Redirect to Fitbit authorization page
                window.location.href = data.authUrl;
                
            } catch (error) {
                console.error('Authorization error:', error);
                alert('Failed to start authorization process. Please ensure the backend server is running.');
            }
        });
    </script>
</body>
</html>